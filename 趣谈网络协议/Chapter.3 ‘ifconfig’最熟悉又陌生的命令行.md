
# ipconfig 最熟悉又陌生的命令行

查询IP地址：
- windows：ipconfig
- linux：ifconfig/ip addr

![ip addr](https://images2018.cnblogs.com/blog/562318/201807/562318-20180720104549272-1124047236.png)

## ip地址

IP地址被点分隔成四个部分，每个部分8bit，所以ip地址总共32位。

IPv6/inet6是128位。

![IP地址分类](https://images2015.cnblogs.com/blog/880287/201604/880287-20160403105152098-758758870.gif)

类别 | ip地址范围 | 最大主机数 | 私有ip地址范围
-----|------------|-----------|---------------
A|0.0.0.0-127.255.255.2555|16777214|10.0.0.0-10.255.255.255
B|128.0.0.0-191.255.255.255|65534|172.16.0.0-172.31.255.255
C|192.0.0.0-223.255.255.255|254|192.168.0.0-192.168.255.255

这五类地址中，D类是**组播地址**。使用这一类地址，属于某个组的机器都能收到。

在IP地址的后面有一个scope，对于eth0这张网卡来讲，是global，说明这张网卡是可以外放的，可以接收来自各个地方的包。对于lo来讲，是host，说明这张网卡仅仅可以供本机相互通信。

lo全程是**loopback**，又称**环回接口**，往往会被分配到127.0.0.1这个地址。这个地址用于本机通信，经过内核处理后直接返回，不会再任何网络中出现。

## 无类型域间选路(CIDR)

这种方法将32位的ip地址一分为二，前面是**网络号**，后面是**主机**。ip地址使用“/”分隔，分隔符后面的数字表示网络号的位数，而剩余的是主机号。

伴随CIDR存在的有两个，一个是**广播地址**，即10.100.122.255。如果发送这个地址，所有的10.100.122网络里面的所有机器都可以收到信息。第二个是**子掩码**，255.255.255.0。将子掩码和ip地址按位计算AND，就可得到网络号。

## 共有ip地址和私有ip地址

公有ip地址是有个组织同意分配，需要购买。

192.168.0.X是最常用的ip地址。192.168.0.1是一般是这个私有网络的出口地址。而192.168.0.255是广播地址。

## 举例：一个容易“犯错”的CIDR

已知16.158.165.92/22这个CIDR，求一下这个网络的第一个地址、子网掩码和广播地址

因为22不是8的整数倍数，所以网络号为前两个节点以及第三个节点的前6位（16+6=22）。
首先将165抓换成二进制=>10100101，所以网络号就是16.158.<101001>，机器号是<01>.91
因为第三个节点不够8位，所以在后面补充<00>，所以网络号位16.158.164。
所以，第一个地址是16.158.164.1；子网掩码是255.255.<111111>+<00> => 255.255.252.0;广播地址是16.158.<101001>+<11>.255 => 16.158.167.255

## MAC地址

在IP地址的上一行是link/etherfa:16:3e:c7:79:75 brd ff:ff:ff:ff:ff:ff,这个被称为**MAC地址**。
是一个网卡的物理地址，用十六进制，6个byte表示。

**一个网络包要从一个地方传到另一个地方，除了要有确定的地址，还需要有定位功能。**

**MAC地址更像是身份证，是一个唯一的标识。**

MAC地址的**唯一性**设计是为了组网的时候，不同的网卡放在一个网络里面的时候，可以不用担心冲突。
从硬件角度，保证不同的网卡有不同的标识。

**所以，MAC地址的通信范围比较小，局限在一个子网里面。**

## 网络设备的状态标识

<BROADCAST,MULTICAST,UP,LOWER_UP>这个叫做**net_device flags,网络设备的状态标识。**
- UP：表示网卡处于启动状态
- BROADCAST：表示这个网卡有广播地址，可以发送广播包
- MULTICAST：表示网卡可以发送多播包
- LOWER_UP：表示L1是启动的，即网线插着
- MTU1500：表示以太网的默认值的最大输出单元MTU为1500

MTU是二层MAC层的概念。MAC层有MAC的头，以太网规定连MAC头带正文合起来，不允许超过1500个字节。

正文有IP的头、TCP的头、HTTP的头。如果放不下，就需要分片来传播。

## qdisc pfifo_fast
qdisc全程是**queueing discipline**，中文叫**排队规则**。

内核如果需要通过某个网络接口发送数据包，它都需要按照为这个接口配置的qdisc（排队规则）包数据包加入队列。

最简单的qdisc是pfifo，它不对进入的数据包做任何的处理，数据包采用先入先出的方式通过队列。
pfifo_fast稍微复杂一点，它的队列包括三个波段（band）。在每个波段里面，使用先进先出的规则。

三个波段的优先级也不相同。band 0的优先级最高，band 2的最低。如果band 0里面有数据包，系统就不会处理band 1里面的数据包，以此类推。

数据包是按照**服务类型（Type of Service, TOS）**被分配到三个波段里边。TOS是IP头里面的一个字段，代表了当前的包高优先级的，还是低优先级的。


```python

```
