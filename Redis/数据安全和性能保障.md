# 持久化选项1. 快照：将存在于某一时刻的所有数据都写入到硬盘里面2. 只追加文件：在执行写命令时，将被执行的写命令复制到硬盘里面 ## 快照持久化根据配置，快照将被写入dbfilename选项指定的文件里面，并存储在dir选项指定的路径上面创建快照的办法：1. 客户端可以通过向Redis发送BGSAVE命令来创建快照，Redis会调用fork来创建一个子进程，然后子进程负责将快照写入硬盘，而父进程则继续处理命令请求2. 客户端可以通过向Redis发送SAVE命令来创建快照，Redis接到命令后在快照创建完毕之前将不再执行任何命令3. 当设置的save配置选项中有条件达成时，Redis服务器将触发一次BGSAVE命令  4. 当Redis通过SHUTDOWN命令接收到关闭服务器的请求时，或者接收到标准TREM信号时，会执行一个BGSAVE命令，之后关闭服务器5. 当一个Redis服务器连接到另一个Redis服务器，并向对方发送命令开始复制操作时，如果主服务器没有执行BGSAVE命令或不是刚刚完成BGSAVE操作，主服务器将会执行BGSAVE命令**如果系统发生崩溃，用户将丢失最近一次生成快照之后更改的所有数据**使用场景1. 个人开发2. 对日志进行聚合计算3. 大数据## AOF持久化AOF持久化会将被执行的写命令写道AOF文件的末尾，以此来记录数据发生的变化appendfsync：配置AOF同步频率- always：每个Redis写命令都要同步写入硬盘- everysec：每秒执行一次，显式地将多个写命令同步到硬盘- no：让操作系统来决定应该何时进行同步AOF的缺点- 随着Redis不断运行，AOF文件的体积也会不断增长，最终占据大量的存储空间- 如果AOF文件过大，下一次启动Redis时还原操作执行的时间会非常长BGREWRITEAOF命令：命令会通过移除AOF文件中的冗余命令来重写AOF文件，使AOF文件的体积变得尽可能地小。- 原理：调用一个子进程进行文件重写，但是有可能会产生性能问题和内存占用问题- auto-aof-rewrite-precentage 100：当AOF扩大了100%之后进行重写- auto-aof-rewirte-min-size 64mb：当AOF大于64mb时进行重写- **如果以上两个同时被设置，那么只有当两个条件都成立时才会重写**## 复制SLAVEOF- 配置slaveof host port，Redis服务器将根据该选项给定的IP地址和端口号连接主服务器- 发送slaveof no one命令，让服务器终止复制操作，不再接受主服务器的数据更新- 发送slaveof host port命令，让服务器开始复制一个新的服务器检验硬盘写入：检查INFO命令的输出结果中aof_pending_pio_fsync的属性值是否为0